package rules

import io.rizvan.beans.facts.PlayerAimFact;
import io.rizvan.beans.facts.PlayerMovementFact;
import io.rizvan.beans.facts.PlayerShootingFact;
import io.rizvan.beans.facts.PlayerCollectionFact;
import io.rizvan.beans.facts.GameTimeChangeFact;
import io.rizvan.beans.facts.ResourcesChangeFact;
import io.rizvan.beans.AgentKnowledge;
import io.rizvan.beans.actors.Agent;
import io.rizvan.beans.KnowledgeUpdateSignal;
import io.rizvan.beans.KnowledgeInferredSignal;

rule "Player Moved"
agenda-group "inference-group"
no-loop true
    when
        $moveFact : PlayerMovementFact()
        $knowledge : AgentKnowledge()
        $signal : KnowledgeUpdateSignal()
    then
    System.out.println("Player Moved ran");
        modify($knowledge){
            setPlayerX($moveFact.getX()),
            setPlayerY($moveFact.getY())
        }
        modify($signal) {
            setRunInference(true)
        }
end

rule "Player Aimed"
agenda-group "inference-group"
no-loop true
    when
        $aimFact : PlayerAimFact()
        $knowledge : AgentKnowledge()
        $signal : KnowledgeUpdateSignal()
    then
        System.out.println("Player aimed ran");
        modify($knowledge) {
            setMouseX($aimFact.getMouseX()),
            setMouseY($aimFact.getMouseY())
        }
        modify($signal) {
            setRunInference(true)
        }
end

rule "Player shot"
agenda-group "inference-group"
no-loop true
    when
        $shootingFact : PlayerShootingFact()
        $knowledge : AgentKnowledge()
        $signal : KnowledgeUpdateSignal()
    then
        modify($knowledge) {
            setPlayerDamage($shootingFact.getDamage())
        }
        modify($signal) {
            setRunInference(true)
        }
end

rule "Player collected resource"
agenda-group "inference-group"
no-loop true
    when
        $collectionFact : PlayerCollectionFact()
        $knowledge : AgentKnowledge()
        $signal : KnowledgeUpdateSignal()
    then
        System.out.println("Player collected ran");
        modify($knowledge){
            setPlayerPoints($collectionFact.getTotalPoints())
        }
        modify($signal) {
            setRunInference(true)
        }
end

rule "Resource Points Changed"
agenda-group "inference-group"
no-loop true
    when
        $resourcesChangedFact : ResourcesChangeFact()
        $knowledge : AgentKnowledge()
        $signal : KnowledgeUpdateSignal()
    then
        modify($knowledge) {
            setResourcePointLocations($resourcesChangedFact.getResources())
        }
        modify($signal) {
            setRunInference(true)
        }
end

rule "Game Time Changed"
agenda-group "inference-group"
no-loop true
    when
        $timeChangeFact : GameTimeChangeFact()
        $knowledge : AgentKnowledge()
        $signal : KnowledgeUpdateSignal()
    then
       modify($knowledge) {
           setTimeLeft($timeChangeFact.getTimeLeft())
       }
       modify($signal) {
           setRunInference(true)
       }
end

rule "Knowledge Inference"
agenda-group "inference-group"
salience -100
    when
        $knowledge : AgentKnowledge() and
        $signal : KnowledgeUpdateSignal(shouldRunInference())
    then

    System.out.println("Knowledge Inference ran");

    modify($signal){
        setRunInference(false)
    }
    insert(new KnowledgeInferredSignal());
end

