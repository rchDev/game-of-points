package rules

import io.rizvan.beans.knowledge.AgentKnowledge;
import io.rizvan.beans.KnowledgeInferredSignal
import io.rizvan.beans.actors.Agent
import io.rizvan.beans.knowledge.AgentPossibilities;

rule "Determine if a kill is possible"
agenda-group "possibilities-group"
no-loop true
    when
        $agent : Agent($damage : getDamage(), $ammo : getAmmo())
        $knowledge : AgentKnowledge($playerHitPoints : getPlayerHitPoints())
        $possibilities : AgentPossibilities()
        $signal : KnowledgeInferredSignal(isProcessed() == false)
        eval($playerHitPoints.getValue() <= $damage * $ammo)
    then
        modify($possibilities) {
            setCanKillPlayer(true)
        }
        modify($signal) {
            setProcessed(true)
        }
end

rule "Determine if one shot kill is possible"
agenda-group "possibilities-group"
no-loop true
    when
        $agent : Agent($damage : getDamage())
        $knowledge : AgentKnowledge($playerHitPoints : getPlayerHitPoints())
        $possibilities : AgentPossibilities()
        $signal : KnowledgeInferredSignal(isProcessed() == false)
        eval($playerHitPoints.getValue() <= $damage)
    then
        modify($possibilities) {
            setCanOneShootPlayer(true)
        }
        modify($signal) {
            setProcessed(true)
        }
end

rule "Determine if can get killed by player"
agenda-group "possibilities-group"
no-loop true
    when
        $agent : Agent($hitPoints : getHitPoints())
        $knowledge : AgentKnowledge($playerDamage : getPlayerDamage(), $playerAmmo : getPlayerAmmoCapacity())
        $possibilities : AgentPossibilities()
        $signal : KnowledgeInferredSignal(isProcessed() == false)
        eval($hitPoints <= $playerDamage.getValue() * $playerAmmo.getValue())
    then
        modify($possibilities) {
            setKilledByPlayer(true)
        }
        modify($signal) {
            setProcessed(true)
        }
end

rule "Determine if can get one shot by player"
agenda-group "possibilities-group"
no-loop true
    when
        $agent : Agent($hitPoints : getHitPoints())
        $knowledge : AgentKnowledge($playerDamage : getPlayerDamage())
        $possibilities : AgentPossibilities()
        $signal : KnowledgeInferredSignal(isProcessed() == false)
        eval($hitPoints <= $playerDamage.getValue())
    then
        modify($possibilities) {
            setOneShotByPlayer(true)
        }
        modify($signal) {
            setProcessed(true)
        }
end